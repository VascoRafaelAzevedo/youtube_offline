services:
  yt-server:
    build: .
    container_name: offline-youtube-server
    ports:
      - "8765:8765"
    environment:
      - PORT=8765
      - API_KEY=${API_KEY:-offline_yt_secret_2025}
      - MAX_CACHE_SIZE=${MAX_CACHE_SIZE:-50}
      # Uncomment and set if you have a cookies file:
      # - COOKIES_FILE=/cookies/cookies.txt
    volumes:
      # Persist downloaded videos
      - yt_downloads:/downloads
      # Cache directory for LRU video cache
      - yt_cache:/cache
      # Temp directory for processing
      - yt_temp:/tmp/yt_server_temp
      # Uncomment to mount cookies file:
      # - ./cookies.txt:/cookies/cookies.txt:ro
    restart: unless-stopped
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

volumes:
  yt_downloads:
  yt_cache:
  yt_temp:

